/*!
 * chartjs-gauge.js v0.3.0
 * https://github.com/haiiaaa/chartjs-gauge/
 * (c) 2022 chartjs-gauge.js Contributors
 * Released under the MIT License
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("chart.js")):"function"==typeof define&&define.amd?define(["chart.js"],e):e((t=t||self).Chart)}(this,(function(t){"use strict";var e="default"in t?t.default:t;function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function r(t){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function i(t,e){return(i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function o(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function c(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function l(t,e,a){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,a){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=r(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(a):i.value}})(t,e,a||t)}var u=Chart.helpers,s=u.toPercentage,f=u.toDimension,h=u.toRadians,d=u.addRoundedRectPath,p=u.PI,g=u.TAU,m=u.HALF_PI,y=u._angleBetween;var v=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&i(t,e)}(x,t);var e,u,v,b,M=(e=x,function(){var t,a=r(e);if(o()){var n=r(this).constructor;t=Reflect.construct(a,arguments,n)}else t=a.apply(this,arguments);return c(this,t)});function x(){return a(this,x),M.apply(this,arguments)}return u=x,(v=[{key:"parse",value:function(t,e){l(r(x.prototype),"parse",this).call(this,t,e);var a=this.getDataset(),n=this._cachedMeta;n.minValue=a.minValue||0,n.value=a.value}},{key:"update",value:function(t){var e=this,a=e.chart.chartArea,n=e._cachedMeta,r=n.data,i=e.getMaxBorderWidth()+e.getMaxOffset(r),o=Math.max((Math.min(a.width,a.height)-i)/2,0),c=Math.min(s(e.options.cutout,o),1),l=e._getRingWeight(e.index),u=e._getRotationExtents(),h=u.circumference,d=function(t,e,a,n){var r=1,i=1,o=0,c=0;if(e<g){var l=t,u=l+e,s=Math.cos(l),f=Math.sin(l),h=Math.cos(u),d=Math.sin(u),v=n.radiusPercentage,b=n.widthPercentage,M=n.lengthPercentage,x=Math.max(v/100,b/2/100),P=function(t,e,n){return y(t,l,u)?Math.max(1,M/100):Math.max(e,e*a,n,n*a,x)},R=function(t,e,n){return y(t,l,u)?Math.min(-1,-M/100):Math.min(e,e*a,n,n*a,-x)},_=P(0,s,h),w=P(m,f,d),O=R(p,s,h),T=R(p+m,f,d);r=(_-O)/2,i=(w-T)/2,o=-(_+O)/2,c=-(w+T)/2}return{ratioX:r,ratioY:i,offsetX:o,offsetY:c}}(u.rotation,h,c,this.options.needle),v=d.ratioX,b=d.ratioY,M=d.offsetX,x=d.offsetY,P=(a.width-i)/v,R=(a.height-i)/b,_=Math.max(Math.min(P,R)/2,0),w=f(e.options.radius,_),O=(w-Math.max(w*c,0))/e._getVisibleDatasetWeightTotal();e.offsetX=M*w,e.offsetY=x*w,n.total=e.calculateTotal(),e.outerRadius=w-O*e._getRingWeightOffset(e.index),e.innerRadius=Math.max(e.outerRadius-O*l,0),e.updateElements(r,0,r.length,t)}},{key:"calculateTotal",value:function(){var t,e=this._cachedMeta,a=e.data,n=0,r=e.minValue,i=e.minValue;for(t=0;t<a.length;t++){var o=e._parsed[t];null!==o&&!isNaN(o)&&this.chart.getDataVisibility(t)&&(o<r&&(r=o),o>i&&(i=o))}return e.minValue=r,null===r||isNaN(r)||null===i||isNaN(i)||(n=Math.abs(i-r)),n}},{key:"updateElements",value:function(t,e,a,n){var r,i=this,o="reset"===n,c=i.chart,l=c.chartArea,u=c.options.animation,s=(l.left+l.right)/2,f=(l.top+l.bottom)/2,h=o&&u.animateScale,d=h?0:i.innerRadius,p=h?0:i.outerRadius,g=i.resolveDataElementOptions(e,n),m=i.getSharedOptions(g),y=i.includeOptions(n,m),v=i._getRotation(),b=v;for(e>0&&(b=i._circumference(e,o)+v),r=e;r<e+a;++r){var M=i._circumference(r,o)+v,x=t[r],P={x:s+i.offsetX,y:f+i.offsetY,startAngle:b,endAngle:M,circumference:M-b,outerRadius:p,innerRadius:d};y&&(P.options=m||i.resolveDataElementOptions(r,n)),b=M,i.updateElement(x,r,P,n)}i.updateSharedOptions(m,n,g)}},{key:"calculateCircumference",value:function(t){var e=this._cachedMeta.total,a=this._cachedMeta.minValue;if(e>0&&!isNaN(t)&&!isNaN(a)){var n=a*this._getCircumference()/g;return g*(Math.abs(t-n)/e)}return 0}},{key:"getTranslation",value:function(t){var e=t.chartArea,a=(e.left+e.right)/2,n=(e.top+e.bottom)/2;return{dx:a+this.offsetX||0,dy:n+this.offsetY||0}}},{key:"drawNeedle",value:function(){var t=this.chart,e=t.ctx,a=t.chartArea,n=this.innerRadius,r=this.outerRadius,i=this.options.needle,o=i.radiusPercentage,c=i.widthPercentage,l=i.lengthPercentage,u=i.color,s=a.right-a.left,f=o/100*s,h=c/100*s,d=l/100*(r-n)+n,p=this.getTranslation(this.chart),m=p.dx,y=p.dy,v=this._cachedMeta,b=this._getCircumference(),M=this._getRotation(),x=this.calculateCircumference(v.value*b/g)+M;e.save(),e.translate(m,y),e.rotate(x),e.fillStyle=u,e.beginPath(),e.ellipse(0,0,f,f,0,0,2*Math.PI),e.fill(),e.beginPath(),e.moveTo(0,h/2),e.lineTo(d,0),e.lineTo(0,-h/2),e.fill(),e.restore()}},{key:"drawValueLabel",value:function(){if(this.options.valueLabel.display){var t=this.chart,e=t.ctx,a=t.config,n=t.chartArea,r=a.options.defaultFontFamily,i=a.data.datasets[this.index],o=this.options.valueLabel,c=o.formatter,l=o.fontSize,u=o.color,s=o.backgroundColor,f=o.borderRadius,p=o.padding,g=o.bottomMarginPercentage/100*(n.right-n.left),m=(c||function(t){return t})(i.value).toString();e.textBaseline="middle",e.textAlign="center",l&&(e.font="".concat(l,"px ").concat(r));var y=e.measureText(m).width,v=Math.max(e.measureText("m").width,e.measureText("ï¼·").width),b=-(p.left+y/2),M=-(p.top+v/2),x=p.left+y+p.right,P=p.top+v+p.bottom,R=this.getTranslation(this.chart),_=R.dx,w=R.dy,O=h(this.chart.options.rotation)%(2*Math.PI);_+=g*Math.cos(O+Math.PI/2),w+=g*Math.sin(O+Math.PI/2),e.save(),e.translate(_,w),e.beginPath(),d(e,{x:b,y:M,w:x,h:P,radius:f}),e.fillStyle=s,e.fill(),e.fillStyle=u||a.options.defaultFontColor,e.fillText(m,0,.075*v),e.restore()}}},{key:"draw",value:function(){l(r(x.prototype),"draw",this).call(this),this.drawNeedle()}}])&&n(u.prototype,v),b&&n(u,b),x}(t.DoughnutController);v.id="gauge",v.version="3.0.0",v.overrides={needle:{radiusPercentage:2,widthPercentage:3.2,lengthPercentage:80,color:"rgba(0, 0, 0, 1)"},valueLabel:{display:!0,formatter:null,color:"rgba(255, 255, 255, 1)",backgroundColor:"rgba(0, 0, 0, 1)",borderRadius:5,padding:{top:5,right:5,bottom:5,left:5},bottomMarginPercentage:5},cutout:"50%",rotation:-90,circumference:180,plugins:{legend:{display:!1},tooltip:{enabled:!1}}},e.register(v)}));
